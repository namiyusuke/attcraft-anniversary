---
import { SITE } from "../config";
import { Image } from "astro:assets";
import Layout from "@layouts/Layout.astro";
import LoadingPage from "@components/parts/Loading.astro";
import wine_tool from "@assets/img/wine_tool.png";
import wine_table from "@assets/img/wine_table.png";
import photo from "@assets/img/photo.png";
import drinkMenu from "@assets/img/drink-menu.png";
import direction_people from "@assets/img/direction_people.png";
import direction_menu from "@assets/img/direction_menu.png";
import coding_people from "@assets/img/coding_people.png";
import coding_menu from "@assets/img/coding_menu.png";
import design_people from "@assets/img/design_people.png";
import design_menu from "@assets/img/design_menu.png";
import bar from "@assets/img/bar.png";
import jobHunting_people from "@assets/img/jobHunting_people.png";
import jobHunting_menu from "@assets/img/jobHunting_menu.png";
import company_people from "@assets/img/company_people.png";
import company_menu from "@assets/img/company_menu.png";
import freeLance_people from "@assets/img/freeLance_people.png";
import freeLance_menu from "@assets/img/freeLance_menu.png";
import work_people from "@assets/img/work_people.png";
import work_menu from "@assets/img/work_menu.png";
import web_people from "@assets/img/web_people.png";
import web_menu from "@assets/img/web_menu.png";
import study_people from "@assets/img/study_people.png";
import study_menu from "@assets/img/study_menu.png";
import portfolio_people from "@assets/img/portfolio_people.png";
import portfolio_menu from "@assets/img/portfolio_menu.png";
import chockArt from "@assets/img/chock-art.png";
import mvBg from "@assets/img/bg_mv.png";
import kanpai from "@assets/img/kanpai.png";
import green_brunch from "@assets/img/green_brunch.svg";
import green_leaf01 from "@assets/img/green_leaf01.svg";
import green_leaf02 from "@assets/img/green_leaf02.svg";
import green_leaf03 from "@assets/img/green_leaf03.svg";
import green_leaf04 from "@assets/img/green_leaf04.svg";
import green_leaf05 from "@assets/img/green_leaf05.svg";
import green_leaf06 from "@assets/img/green_leaf06.svg";
import green_leaf07 from "@assets/img/green_leaf07.svg";
import bar_01 from "@assets/img/bar_01.png";
import bar_02 from "@assets/img/bar_02.png";
import bar_03 from "@assets/img/bar_03.png";
import bar_04 from "@assets/img/bar_04.png";
import bar_05 from "@assets/img/bar_05.png";
import bar_06 from "@assets/img/bar_06.png";
import bar_07 from "@assets/img/bar_07.png";
import bar_08 from "@assets/img/bar_08.png";
import bar_09 from "@assets/img/bar_09.png";
import bar_10 from "@assets/img/bar_10.png";
import bar_11 from "@assets/img/bar_11.png";
import beer from "@assets/img/beer.png";
import bar_counter_people3 from "@assets/img/bar_counter_people3.png";
import bar_counter_people4 from "@assets/img/bar_counter_people4.png";
import bar_counter_people5 from "@assets/img/bar_counter_people5.png";
import bar_bottomTable from "@assets/img/bar_bottomTable.png";
import bar_bottomTable_stand from "@assets/img/bar_bottomTable_stand.png";
import bar_bottomTable_char1 from "@assets/img/bar_bottomTable_chra1.png";
import bar_bottomTable_char2 from "@assets/img/bar_bottomTable_chra2.png";
import bar_bottomTable_char3 from "@assets/img/bar_bottomTable_chra3.png";
import bar_bottomTable_char4 from "@assets/img/bar_bottomTable_chra4.png";
import bar_bottomTable_char5 from "@assets/img/bar_bottomTable_chra5.png";
import Loading from "@assets/js/libs/Loading";
import bar_table1 from "@assets/img/bar_table1.png";
import bar_table2 from "@assets/img/detail_beer.png";
import gesture_icon from "@assets/img/gesture_icon.svg";
import bgm from "@assets/audio/bgm.mp3";
---

<Layout title={`${SITE.name} | Welcome to Orelop Astro.`} description="これは俺流スターターキット">
  <LoadingPage />
  <main class="bg-bricks">
    <div class="maps-gesture">
      <div class="maps-gesture__bg"></div>
      <div class="maps-gesture__contents">
        <div class="maps-gesture__contents__icon">
          <Image src={gesture_icon} alt="ジェスチャー" />
        </div>
        <p class="c-crop c-ls maps-gesture__contents__txt">DRAG &amp; DROP<br />or<br /> SWIPE</p>
        <div class="maps-gesture__contents__character"></div>
      </div>
    </div>
    <div id="scroll-container">
      <div id="scroll-content">
        <div class="mv-kanpai">
          <Image src={kanpai} alt="乾杯" />
        </div>
        <div class="mv-bg">
          <Image src={mvBg} alt="メインビジュアル" />
        </div>
        <div class="bg_wine_table">
          <Image src={wine_table} alt="バーの下のテーブル" />
        </div>
        <div class="mv-title">
          <h2 class="mv-title--center">
            <span>
              <span class="mv-title--sm">ここは</span>
              <span class="mv-title--lg">シバジュク酒場</span>
              <span class="mv-title--white">隣の人の会話を盗みぎき</span>
            </span>
          </h2>
        </div>
        <div class="scroll-body">
          <div class="bg-wine">
            <Image src={wine_tool} alt="ワイン６本" />
          </div>
          <div class="bg-photo">
            <Image src={photo} alt="メニューの写真" />
          </div>
          <div class="bg-spotlight bg-drinkMenu">
            <Image src={drinkMenu} alt="メニューの写真" />
          </div>
          <div class="js-spotlight bg-direction">
            <a href="/direction/">
              <audio controls data-auto-play data-audio="direction"></audio>
              <span class="odject-direction--people">
                <Image src={direction_people} alt="ディレクション" />
              </span>
              <span class="odject-menu odject-direction--menu">
                <Image src={direction_menu} alt="ディレクションのメニュー" />
              </span>
            </a>
          </div>
          <div class="js-spotlight bg-coding">
            <a href="/coding/">
              <audio controls data-auto-play data-audio="coding"></audio>
              <span class="odject-coding--people">
                <Image src={coding_people} alt="コーディング" />
              </span>
              <span class="odject-menu odject-coding--menu">
                <Image src={coding_menu} alt="コーディングのメニュー" />
              </span>
            </a>
          </div>
          <div class="js-spotlight bg-design">
            <a href="/design/">
              <audio controls data-auto-play data-audio="design"></audio>
              <span class="odject-design--people">
                <Image src={design_people} alt="デザイン" />
              </span>
              <span class="odject-menu odject-design--menu">
                <Image src={design_menu} alt="デザインのメニュー" />
              </span>
            </a>
          </div>
          <div class="bg-bar">
            <Image src={bar} alt="バーカウンター" />
            <div class="bg-bar--beer1">
              <Image src={beer} alt="ビール" />
            </div>
            <div class="bg-bar--beer2">
              <Image src={beer} alt="ビール" />
            </div>
            <div class="bg-bar--beer3">
              <Image src={beer} alt="ビール" />
            </div>
          </div>
          <div class="bg-">
            <div class="bar-counter-people3">
              <Image src={bar_counter_people3} alt="バーのカウンター" />
            </div>
          </div>
          <div class="bg-">
            <div class="bar-counter-people4">
              <Image src={bar_counter_people4} alt="バーのカウンター" />
            </div>
          </div>
          <div class="bg-bar1">
            <Image src={bar_01} alt="バーカウンター" />
          </div>
          <div class="bg-bar2">
            <Image src={bar_02} alt="バーカウンター" />
          </div>
          <div class="bg-bar3">
            <Image src={bar_03} alt="バーカウンター" />
          </div>
          <div class="bg-bar4">
            <Image src={bar_04} alt="バーカウンター" />
          </div>
          <div class="bg-bar5">
            <Image src={bar_05} alt="バーカウンター" />
          </div>
          <div class="bg-bar6">
            <Image src={bar_06} alt="バーカウンター" />
          </div>
          <div class="bg-bar7">
            <Image src={bar_07} alt="バーカウンター" />
          </div>
          <div class="bg-bar8">
            <Image src={bar_08} alt="バーカウンター" />
          </div>
          <div class="bg-bar9">
            <Image src={bar_09} alt="バーカウンター" />
          </div>
          <div class="bg-bar10">
            <Image src={bar_10} alt="バーカウンター" />
          </div>
          <div class="bg-bar11">
            <Image src={bar_11} alt="バーカウンター" />
          </div>
          <div class="bg-bottomTable">
            <Image src={bar_bottomTable} alt="バーの下のテーブル" />
          </div>
          <div class="bg-bottomTableStand">
            <Image src={bar_bottomTable_stand} alt="バーの下のテーブル" />
          </div>
          <div class="bg-">
            <div class="bar-counter-people5">
              <Image src={bar_counter_people5} alt="バーのカウンター" />
            </div>
          </div>
          <div class="bg_bottomTable_chra1">
            <Image src={bar_bottomTable_char1} alt="バーの下のテーブル" />
          </div>
          <div class="bg_bottomTable_chra2">
            <Image src={bar_bottomTable_char2} alt="バーの下のテーブル" />
          </div>
          <div class="bg_bottomTable_chra3">
            <Image src={bar_bottomTable_char3} alt="バーの下のテーブル" />
          </div>
          <div class="bg_bottomTable_chra4">
            <Image src={bar_bottomTable_char4} alt="バーの下のテーブル" />
          </div>
          <div class="bg_bottomTable_chra5">
            <Image src={bar_bottomTable_char5} alt="バーの下のテーブル" />
          </div>
        </div>
        <div class="js-spotlight bg-jobHunting">
          <a href="/job-hunting/">
            <audio controls data-auto-play data-audio="jobHunting"></audio>
            <span class="odject-jobHunting--people">
              <Image src={jobHunting_people} alt="就活転職" />
            </span>
            <span class="odject-menu odject-jobHunting--menu">
              <Image src={jobHunting_menu} alt="就活転職のメニュー" />
            </span>
          </a>
        </div>
        <div class="js-spotlight bg-company">
          <a href="/company/">
            <audio controls data-auto-play data-audio="company"></audio>
            <span class="odject-company--people">
              <Image src={company_people} alt="制作会社" />
            </span>
            <span class="odject-menu odject-company--menu">
              <Image src={company_menu} alt="制作会社のメニュー" />
            </span>
          </a>
        </div>
        <div class="js-spotlight bg-freeLance">
          <a href="/free-lance/">
            <span class="odject-freeLance--people">
              <Image src={freeLance_people} alt="フリーランス" />
            </span>
            <span class="odject-menu odject-freeLance--menu">
              <Image src={freeLance_menu} alt="フリーランスのメニュー" />
            </span>
            <audio controls data-auto-play data-audio="freeLance"></audio>
          </a>
        </div>
        <div class="js-spotlight bg-work">
          <a href="/work/">
            <audio controls data-auto-play data-audio="work"></audio>
            <span class="odject-company--people">
              <Image src={work_people} alt="仕事" />
            </span>
            <span class="odject-menu odject-company--menu">
              <Image src={work_menu} alt="仕事のメニュー" />
            </span>
          </a>
        </div>
        <div class="js-spotlight bg-web">
          <a href="/web/">
            <audio controls data-auto-play data-audio="web"></audio>
            <span class="odject-web--people">
              <Image src={web_people} alt="web" />
            </span>
            <span class="odject-menu odject-web--menu">
              <Image src={web_menu} alt="デザインのメニュー" />
            </span>
          </a>
        </div>
        <div class="bg-table1">
          <Image src={bar_table1} alt="バーのテーブル1" />
        </div>
        <div class="bg-table2">
          <Image src={bar_table2} alt="バーのテーブル2" />
        </div>
        <div class="js-spotlight bg-study">
          <a href="/study/">
            <audio controls data-auto-play data-audio="study"></audio>
            <span class="odject-study--people">
              <Image src={study_people} alt="勉強法" />
            </span>
            <span class="odject-menu odject-study--menu">
              <Image src={study_menu} alt="勉強法のメニュー" />
            </span>
          </a>
        </div>
        <div class="js-spotlight bg-portfolio">
          <a href="/portfolio/">
            <audio controls data-auto-play data-audio="portfolio"></audio>
            <span class="odject-portfolio--people">
              <Image src={portfolio_people} alt="ポートフォリオ" />
            </span>
            <span class="odject-menu odject-portfolio--menu">
              <Image src={portfolio_menu} alt="ポートフォリオのメニュー" />
            </span>
          </a>
        </div>
        <div class="bg-chockArt">
          <Image src={chockArt} alt="絵" />
        </div>
        <div class="bg-green">
          <div class="bg-green--brunch">
            <Image src={green_brunch} alt="草木" />
          </div>
          <div class="bg-green--leaf01">
            <Image src={green_leaf01} alt="草木" />
          </div>
          <div class="bg-green--leaf02">
            <Image src={green_leaf02} alt="草木" />
          </div>
          <div class="bg-green--leaf03">
            <Image src={green_leaf03} alt="草木" />
          </div>
          <div class="bg-green--leaf04">
            <Image src={green_leaf04} alt="草木" />
          </div>
          <div class="bg-green--leaf05">
            <Image src={green_leaf05} alt="草木" />
          </div>
          <div class="bg-green--leaf06">
            <Image src={green_leaf06} alt="草木" />
          </div>
          <div class="bg-green--leaf07">
            <Image src={green_leaf07} alt="草木" />
          </div>
        </div>
        <!-- <Image src={green} alt="草木" /> -->
      </div>
    </div>
    <div class="light"></div>
  </main>
  <button class="js-bgm-control">
    <span class="js-bgm-control--text">BGM</span>
    <span class="js-bgm-control--icon">
      <svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M8.08133 0C7.00969 0 5.98194 0.425706 5.22418 1.18347C4.46642 1.94123 4.04072 2.96897 4.04072 4.04061V9.69747C4.04072 10.7691 4.46642 11.7968 5.22418 12.5546C5.98194 13.3124 7.00969 13.7381 8.08133 13.7381C9.15296 13.7381 10.1807 13.3124 10.9385 12.5546C11.6962 11.7968 12.1219 10.7691 12.1219 9.69747V4.04061C12.1219 2.96897 11.6962 1.94123 10.9385 1.18347C10.1807 0.425706 9.15296 0 8.08133 0ZM1.61635 8.88934C1.83068 8.88934 2.03623 8.97448 2.18778 9.12604C2.33933 9.27759 2.42447 9.48314 2.42447 9.69747C2.42447 11.1978 3.02046 12.6366 4.08133 13.6975C5.14219 14.7583 6.58103 15.3543 8.08133 15.3543C9.58162 15.3543 11.0205 14.7583 12.0813 13.6975C13.1422 12.6366 13.7382 11.1978 13.7382 9.69747C13.7382 9.48314 13.8233 9.27759 13.9749 9.12604C14.1264 8.97448 14.332 8.88934 14.5463 8.88934C14.7606 8.88934 14.9662 8.97448 15.1177 9.12604C15.2693 9.27759 15.3544 9.48314 15.3544 9.69747C15.3548 11.4867 14.6955 13.2133 13.5028 14.5471C12.3101 15.8808 10.6676 16.7281 8.88945 16.9269V18.5868C8.88945 18.8011 8.80431 19.0067 8.65275 19.1582C8.5012 19.3098 8.29565 19.3949 8.08133 19.3949C7.867 19.3949 7.66145 19.3098 7.5099 19.1582C7.35834 19.0067 7.2732 18.8011 7.2732 18.5868V16.9269C5.49502 16.7281 3.85252 15.8808 2.65981 14.5471C1.4671 13.2133 0.807884 11.4867 0.808228 9.69747C0.808228 9.48314 0.893369 9.27759 1.04492 9.12604C1.19647 8.97448 1.40202 8.88934 1.61635 8.88934Z"
          fill="black"></path>
      </svg>
    </span>
  </button>
</Layout>
<audio class="js-bgm" src={bgm} autoplay loop></audio>

<script>
  const xmlUrl = "https://anchor.fm/s/132fb79c/podcast/rss";

  // 検索キーワードの設定
  const SEARCH_CONFIGS = {
    jobHunting: ["就職", "転職"],
    freeLance: ["フリーランス", "フリランス", "個人事業主"],
    company: ["制作会社"],
    work: ["仕事"],
    web: ["Web"],
    study: ["勉強"],
    portfolio: ["ポートフォリオ"],
    direction: ["ディレクター"],
    coding: ["コーディング"],
    design: ["デザイン"],
    // 必要に応じて他のカテゴリーを追加
  };

  async function fetchAndDisplayFilteredEpisodes() {
    try {
      const response = await fetch(xmlUrl);
      const xmlText = await response.text();
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlText, "text/xml");

      const items = xmlDoc.getElementsByTagName("item");
      const results = {};

      // data-audio属性を持つ要素をすべて取得
      const audioElements = document.querySelectorAll("[data-audio]");
      const targetCategories = Array.from(audioElements).map((el) => el.dataset.audio);

      // 各カテゴリーごとにURLの配列を初期化
      targetCategories.forEach((category) => {
        results[category] = [];
      });

      for (let i = 0; i < items.length; i++) {
        const item = items[i];
        const titleElement = item.getElementsByTagName("title")[0];
        const enclosureElement = item.getElementsByTagName("enclosure")[0];
        const summaryElements = item.getElementsByTagNameNS("*", "summary");

        const title = titleElement ? titleElement.textContent : "";
        const summary = summaryElements.length > 0 ? summaryElements[0].textContent : "";
        const audioUrl = enclosureElement ? enclosureElement.getAttribute("url") : "";

        // 各カテゴリーごとにキーワードチェック
        targetCategories.forEach((category) => {
          const keywords = SEARCH_CONFIGS[category] || [];
          if (keywords.some((keyword) => title.includes(keyword) || summary.includes(keyword))) {
            results[category].push(audioUrl);
          }
        });
      }

      return results;
    } catch (error) {
      console.error("Error fetching or parsing the XML:", error);
      return {};
    }
  }

  // 使用例
  fetchAndDisplayFilteredEpisodes().then((categoryResults) => {
    // 各カテゴリーの要素にURLを設定
    Object.entries(categoryResults).forEach(([category, urls]) => {
      const elements = document.querySelectorAll(`[data-audio="${category}"]`);
      elements.forEach((element) => {
        if (urls.length > 0) {
          // ランダムにURLを選ぶ関数
          const getRandomUrl = (urlArray) => urlArray[Math.floor(Math.random() * urlArray.length)];

          // ランダムなURLを取得
          const randomUrl = getRandomUrl(urls);

          // 選ばれたURLを使用
          element.setAttribute("src", randomUrl);
          // または全てのURLを保存する場合
          element.setAttribute("data-urls", JSON.stringify(urls));
        }
      });
    });
  });

  class ProximityAudioPlayer {
    constructor(audioElement, triggerElement, options = {}) {
      this.audioElement = audioElement;
      this.triggerElement = triggerElement;
      this.maxDistance = options.maxDistance || 300;
      this.minVolume = options.minVolume || 0;
      this.maxVolume = options.maxVolume || 1;
      this.startTime = options.startTime || 0;
      this.isPlaying = false;
      this.hasInteracted = false;
      this.lastPlayPosition = this.startTime; // 最後に再生していた位置を保存

      this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

      this.initializeAudio();

      if (this.isMobile) {
        this.setupMobileBehavior();
      } else {
        this.setupDesktopBehavior();
      }
    }

    initializeAudio() {
      this.audioElement.loop = true;
      this.audioElement.volume = this.minVolume;
      this.audioElement.currentTime = this.startTime;
      this.audioElement.preload = "none"; // 初期ロードを防止

      // 再生位置を保存
      this.audioElement.addEventListener("timeupdate", () => {
        this.lastPlayPosition = this.audioElement.currentTime;
      });

      this.audioElement.addEventListener("error", (e) => {
        console.error("Audio error:", e);
        this.retryPlay();
      });
    }

    handleMouseMove(event) {
      if (!this.hasInteracted) return;

      if (this.animationFrame) {
        cancelAnimationFrame(this.animationFrame);
      }

      this.animationFrame = requestAnimationFrame(() => {
        const rect = this.triggerElement.getBoundingClientRect();
        const elementCenter = {
          x: rect.left + rect.width / 2,
          y: rect.top + rect.height / 2,
        };

        const distance = Math.sqrt(
          Math.pow(event.clientX - elementCenter.x, 2) + Math.pow(event.clientY - elementCenter.y, 2)
        );

        // 距離に基づいて再生/停止を制御
        if (distance <= this.maxDistance) {
          if (!this.isPlaying) {
            this.resumeFromLastPosition();
          }
          // 音量調整
          const newVolume =
            this.minVolume + (this.maxVolume - this.minVolume) * Math.pow(1 - distance / this.maxDistance, 2);
          this.audioElement.volume = Math.max(0, Math.min(1, newVolume));
        } else if (this.isPlaying) {
          this.pauseAndSavePosition();
        }
      });
    }

    async resumeFromLastPosition() {
      try {
        this.audioElement.currentTime = this.lastPlayPosition;
        await this.audioElement.play();
        this.isPlaying = true;
        console.log("Resumed from position:", this.lastPlayPosition);
      } catch (error) {
        console.warn("Resume playback failed:", error);
      }
    }

    pauseAndSavePosition() {
      this.lastPlayPosition = this.audioElement.currentTime;
      this.audioElement.pause();
      this.isPlaying = false;
      console.log("Paused at position:", this.lastPlayPosition);
    }

    setupDesktopBehavior() {
      const startPlayback = async (event) => {
        if (!this.hasInteracted) {
          this.hasInteracted = true;
          // 初回クリック時は再生を開始しない
          console.log("Interaction enabled");
        }
      };

      document.addEventListener("click", startPlayback, { once: true });
      document.addEventListener("mousemove", this.handleMouseMove.bind(this));
    }

    setupMobileBehavior() {
      // Intersection Observerの設定
      this.observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting && this.hasInteracted) {
              // 画面内に入った時
              this.startPlaying();
              this.audioElement.volume = this.maxVolume;
            } else {
              // 画面外に出た時
              this.stop();
            }
          });
        },
        {
          threshold: 0.6, // 30%表示されたら発火
          rootMargin: "0px",
        }
      );

      // 要素の監視を開始
      this.observer.observe(this.triggerElement);

      // 初回インタラクションの設定
      const enableAudio = () => {
        this.hasInteracted = true;
        // 現在表示されている要素の音声を開始
        if (this.isElementInView(this.triggerElement)) {
          this.startPlaying();
          this.audioElement.volume = this.maxVolume;
        }
      };

      document.addEventListener("click", enableAudio, { once: true });
      document.addEventListener("touchstart", enableAudio, { once: true });
    }

    isElementInView(element) {
      const rect = element.getBoundingClientRect();
      return rect.top >= 0 && rect.left >= 0 && rect.bottom <= window.innerHeight && rect.right <= window.innerWidth;
    }

    async startPlaying() {
      try {
        await this.audioElement.play();
        this.isPlaying = true;
        console.log("Audio started successfully");
      } catch (error) {
        console.warn("Playback failed:", error);
        this.retryPlay();
      }
    }

    async retryPlay(maxRetries = 10, delay = 6000) {
      let retries = 0;
      const tryPlay = async () => {
        try {
          if (retries < maxRetries && !this.isPlaying) {
            await this.audioElement.play();
            this.isPlaying = true;
            console.log("Retry successful");
          }
        } catch (error) {
          retries++;
          if (retries < maxRetries) {
            console.log(`Retry attempt ${retries} failed, trying again in ${delay}ms`);
            setTimeout(tryPlay, delay);
          }
        }
      };
      tryPlay();
    }

    stop() {
      this.isPlaying = false;
      this.audioElement.pause();
      this.audioElement.currentTime = this.startTime;
    }

    destroy() {
      if (this.observer) {
        this.observer.disconnect();
      }
      if (this.animationFrame) {
        cancelAnimationFrame(this.animationFrame);
      }
      this.pauseAndSavePosition();
      this.audioElement.removeEventListener("timeupdate", () => {});
    }
  }

  // 初期化
  document.querySelectorAll("[data-auto-play]").forEach((audio) => {
    const triggerElement = audio.closest("div");
    if (triggerElement) {
      new ProximityAudioPlayer(audio, triggerElement, {
        maxDistance: 300,
        minVolume: 0,
        maxVolume: 0.6,
        startTime: 30,
      });
    }
  });

  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("scroll-container");
    // コンテナのサイズとスクロール量を取得
    const containerWidth = container.scrollWidth;
    const containerHeight = container.scrollHeight;
    const containerVisibleWidth = container.clientWidth;
    const containerVisibleHeight = container.clientHeight;

    // スクロール位置を中央に設定
    container.scrollLeft = (containerWidth - containerVisibleWidth) / 2;
    container.scrollTop = (containerHeight - containerVisibleHeight) / 2;
  });

  // document.addEventListener("DOMContentLoaded", () => {
  //   const mapsGesture = document.querySelector(".maps-gesture");
  //   mapsGesture.classList.add("is-shown");
  // });

  class BGM {
    constructor() {
      this.audio = document.querySelector(".js-bgm");
      this.onButton = document.querySelector(".js-loading--on");
      this.offButton = document.querySelector(".js-loading--open");
      this.audioPlay = document.querySelector(".js-bgm-control");
      this.audioConditions = false;
      if (this.audio) {
        this.audio.volume = 0.2;

        // クリックイベントを待ってから再生開始
        const startAudio = () => {
          this.audio
            .play()
            .then(() => {
              console.log("再生開始");
            })
            .catch((error) => {
              console.log("再生エラー:", error);
            });
        };
        const stopAudio = () => {
          this.audioConditions = false;
          this.audio.pause();
        };
        const toggleAudio = () => {
          console.log(this.audioConditions);
          if (this.audioConditions) {
            this.audioConditions = false;
            stopAudio();
          } else {
            this.audioConditions = true;
            startAudio();
          }
        };
        // ページ内のどこかをクリックしたら再生開始
        this.onButton.addEventListener("click", startAudio, { once: true });
        this.audioPlay.addEventListener("click", toggleAudio);
        // スペースキーでも再生開始できるように
        document.addEventListener(
          "keydown",
          (e) => {
            if (e.code === "Space" && this.audio.paused) {
              startAudio();
            }
          },
          { once: true }
        );
      }
    }
  }
  new BGM();
</script>
